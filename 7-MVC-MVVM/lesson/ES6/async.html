<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
	</head>

	<body>
		<script type="text/javascript">
			// 股票名称
			getJSON("/stock/name", { keyword: "腾讯" })
				.then(function(res) {
					let { name } = res;
					// 股票代码
					return getJSON("/stock/code", { name })
				})
				.then(function(res) {
					let { code } = res;
					// 股票价格
					return getJSON("/stock/price", { code })
				})
				.then(function(res) {
					let { price } = res;
					console.log('股票价格：' + price);
				});

			async function getStockPrice() {
				// 股票名称
				let { name } = await getJSON("/stock/name", { keyword: "腾讯" });
				// 股票代码
				let { code } = await getJSON("/stock/code", { name });
				// 股票价格
				let { price } = await getJSON("/stock/price", { code });

				console.log('股票价格：' + price);
			}
		</script>
		<script>
			// 1. Promise封装好的方法
			function Random() {
				let promise = new Promise(function(resolve, reject) {
					setTimeout(function() {
						var x = Math.random();
						if (x >= 0.5) {
							resolve(x);
						} else {
							reject('失败：x = ' + x);
						}
					}, 2000)
				});
				return promise
			}
			// 1. async函数将异步操作，按照同步代码的方式书写,更容易理解；
			// 2. await: 捕获Promise函数resolve的值
			// 计算随机两个数字的差值
			async function cal() {
				let m = await Random();
				let n = await Random();
				if (m > n) {
					return m - n
				} else {
					return n - m;
				}
			}
			cal();
			// 3. 封装成async函数
		</script>
		<script type="text/javascript">
			async function sum(x) {
				await 3.14;
				// 等价于
				await Promise.resolve(3.14);
				// 自动转换
				return x;
				// 等价于
				return Promise.resolve(x);
				// 再等价于
				return new Promise(function(resolve, reject) {
					resolve(x)
				});
			}
		</script>
	</body>

</html>

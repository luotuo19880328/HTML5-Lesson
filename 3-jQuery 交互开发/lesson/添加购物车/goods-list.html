<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8" />
		<title></title>
		<link rel="stylesheet" type="text/css" href="css/reset.css" />
		<link rel="stylesheet" type="text/css" href="css/goods-list.css" />
	</head>

	<body>
		<div class="container">
			<h1>
				<a href="cart.html">进入购物车</a>
			</h1>
			<ul class="clearfix">
				<li data-id="1">
					<div class="photo">
						<img src="img/guess/guess.jpg" />
					</div>
					<div class="title">红米s2 全网通版 4G版</div>
					<div class="price">&yen;999</div>
					<div class="high_opinion">667人好评</div>
					<div class="add_cart">
						加入购物车
					</div>
				</li>
				<li data-id="2">
					<div class="photo">
						<img src="img/guess/guess01.jpg" />
					</div>
					<div class="title">红米5 Plus 全网通版 4GB内存</div>
					<div class="price">
						&yen;999
					</div>
					<div class="high_opinion ">
						2.4万人好评
					</div>
					<div class="add_cart">
						加入购物车
					</div>
				</li>
				<li data-id="3">
					<div class="photo">
						<img src="img/guess/guess02.png" />
					</div>
					<div class="title">
						小米影视会员年卡卷
					</div>
					<div class="price">
						&yen;498
					</div>
					<div class="high_opinion ">
						2人好评
					</div>
					<div class="add_cart">
						加入购物车
					</div>
				</li>
				<li data-id="4">
					<div class="photo">
						<img src="img/guess/guess03.jpg" />
					</div>
					<div class="title">
						小米铁圈耳机
					</div>
					<div class="price">
						&yen;99
					</div>
					<div class="high_opinion ">
						5.5万人好评
					</div>
					<div class="add_cart">
						加入购物车
					</div>
				</li>
				<li data-id="5">
					<div class="photo">
						<img src="img/guess/guess04.jpg" />
					</div>
					<div class="title">
						小米平板4 Plus 10英寸 LTE
					</div>
					<div class="price">
						&yen;669
					</div>
					<div class="high_opinion ">
						667人好评
					</div>
					<div class="add_cart">
						加入购物车
					</div>
				</li>
				<li data-id="6">
					<div class="photo">
						<img src="img/guess/guess05.png" />
					</div>
					<div class="title">
						90分智能金属旅行箱 20寸
					</div>
					<div class="price">
						&yen;1099
					</div>
					<div class="high_opinion ">
						558人好评
					</div>
					<div class="add_cart">
						加入购物车
					</div>
				</li>
				<li data-id="7">
					<div class="photo">
						<img src="img/guess/guess06.png" />
					</div>
					<div class="title">
						1MORE头戴式耳机
					</div>
					<div class="price">
						&yen;299
					</div>
					<div class="high_opinion ">
						666人好评
					</div>
					<div class="add_cart">
						加入购物车
					</div>
				</li>
				<li data-id="8">
					<div class="photo">
						<img src="img/guess/guess07.png" />
					</div>
					<div class="title">
						米家全景相机自拍杆
					</div>
					<div class="price">
						&yen;67
					</div>
					<div class="high_opinion ">
						2人好评
					</div>
					<div class="add_cart">
						加入购物车
					</div>
				</li>
				<li data-id="9">
					<div class="photo">
						<img src="img/guess/guess08.png" />
					</div>
					<div class="title">
						小米V领短袖T恤 女款
					</div>
					<div class="price">
						&yen;9.9
					</div>
					<div class="high_opinion ">
						5.5万人好评
					</div>
					<div class="add_cart">
						加入购物车
					</div>
				</li>
				<li data-id="10">
					<div class="photo">
						<img src="img/guess/guess09.png" />
					</div>
					<div class="title">
						经典款米兔（25cm）
					</div>
					<div class="price">
						&yen;169
					</div>
					<div class="high_opinion ">
						427人好评
					</div>
					<div class="add_cart">
						加入购物车
					</div>
				</li>
			</ul>
		</div>
		<script src="js/jquery-3.5.1.min.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			function setCookie(cname, cvalue, exdays) {
				var d = new Date();
				d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
				var expires = "expires=" + d.toGMTString();
				document.cookie = cname + "=" + cvalue + "; " + expires;
			}

			function getCookie(cname) {
				var name = cname + "=";
				var ca = document.cookie.split(';');
				for (var i = 0; i < ca.length; i++) {
					var c = ca[i].trim();
					var arrC = c.split("=");
					if (arrC[0] == cname) {
						return arrC[1];
					}
				}
				return "";
			}
		</script>
		<script type="text/javascript">
			$('.add_cart').click(function() {
				// 获取商品数据-goods
				var id = $(this).parents('li').data('id');
				var name = $(this).siblings('.title').text().trim();
				var photo = $(this).siblings('.photo').find('img').attr('src');
				var price = $(this).siblings('.price').text().trim();
				var goods = {
					id: id,
					name: name,
					photo: photo,
					price: price,
					num: 1,
				}
				// 1.提取cookie中购物车数组
				var cart = getCookie('cart');
				if (cart) {
					// 2.JSON转换成数组
					cart = JSON.parse(cart);
				} else {
					cart = [];
				}
				// 3.在cart查找此商品，
				var i = cart.findIndex(function(item, index) { return item.id == id; });
				if (i >= 0) {
					// 如果有，数量+1
					cart[i].num += 1;
				} else {
					// 如果无，push进数组
					cart.push(goods);
				}
				// 4.转换成JSON
				cart = JSON.stringify(cart);
				// 5.存储至cookie
				setCookie('cart', cart);
			});
		</script>
	</body>

</html>
